<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather on Click</title>
    <style>
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>Click on the Map to Get Weather</h1>
    <div id="map"></div>
    <div id="weatherInfo"></div>

    <script>
        function initMap() {
            const map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 0, lng: 0 },
                zoom: 2,
            });

            map.addListener("click", (event) => {
                getWeather(event.latLng.lat(), event.latLng.lng());
            });
        }

        async function getAddressDetails(latitude, longitude) {
            const apiKey = 'AIzaSyDYZcOyEtR-S0B5VMr1bWILtvdJOmgpiSQ';
            const geocodingApiUrl = `https://maps.googleapis.com/maps/api/geocode/json?latlng=${latitude},${longitude}&key=${apiKey}`;

            try {
                const response = await fetch(geocodingApiUrl);
                const data = await response.json();

                if (data.status === 'OK' && data.results.length > 0) {
                    const addressComponents = data.results[0].address_components;
                    let countryName = 'Unknown';
                    let stateName = 'Unknown';

                    for (let component of addressComponents) {
                        if (component.types.includes('country')) {
                            countryName = component.long_name;
                        }
                        if (component.types.includes('administrative_area_level_1')) {
                            stateName = component.long_name;
                        }
                    }

                    return { countryName, stateName };
                } else {
                    return { countryName: 'Unknown', stateName: 'Unknown' };
                }
            } catch (error) {
                console.error('Error fetching address details:', error);
                return { countryName: 'Unknown', stateName: 'Unknown' };
            }
        }

        async function getWeather(latitude, longitude) {
            const apiKey = 'b472969fc1be3f3ebafc0fe48343b532';
            const weatherApiUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=${apiKey}&units=metric`;

            try {
                const response = await fetch(weatherApiUrl);
                const data = await response.json();

                const temperatureCelsius = data.main.temp;
                const temperatureFahrenheit = (temperatureCelsius * 9/5) + 32;

                const { countryName, stateName } = await getAddressDetails(latitude, longitude);

                const weatherInfo = document.getElementById('weatherInfo');
                weatherInfo.innerHTML = `
                    <h2>Weather at Clicked Location</h2>
                    <p>Temperature: ${temperatureFahrenheit.toFixed(2)}Â°F</p>
                    <p>Description: ${data.weather[0].description}</p>
                    <p>Country: ${countryName}</p>
                    <p>State/Province: ${stateName}</p>
                `;
            } catch (error) {
                console.error('Error fetching weather data:', error);
                alert('Failed to fetch weather data. Please try again.');
            }
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDYZcOyEtR-S0B5VMr1bWILtvdJOmgpiSQ&callback=initMap" async defer></script>
</body>
</html>
